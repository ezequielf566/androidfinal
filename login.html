<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Pintando a Palavra</title>
  <link rel="stylesheet" href="style.css">

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1116979890524870'); 
    fbq('track', 'PageView');
  </script>
</head>
<body>
  <div class="login-container">
    <img src="icon-512.png" alt="Logo" class="logo">
    <h1>Pintando a Palavra</h1>
    <p class="subtitle">Colorindo hist√≥rias da B√≠blia</p>

    <!-- üü¢ Bot√£o principal -->
    <button id="freeAccess" class="btn-primary">üé® Entrar gratuito</button>

    <!-- üîê Bot√£o Premium -->
    <button id="showLogin" class="btn-secondary">üîë J√° sou Premium</button>

    <!-- ‚úâÔ∏è Campo Gmail (sem placeholder) -->
    <form id="loginForm" class="hidden">
      <input type="email" id="email" placeholder="" required>
      <button type="submit" class="btn-login">Entrar com Gmail</button>
    </form>

    <p id="errorMsg" class="error"></p>

    <div class="checkout">
      <p>Ainda n√£o possui acesso Premium?</p>
      <a id="checkoutBtn" href="https://pintando-a-palavra.pay.yampi.com.br/r/B0H10Z6JLH" target="_blank">
        üí≥ Fazer upgrade
      </a>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDN2p43zoaWoFuRcxrBMmNE8_Cm0d0ecw8",
      authDomain: "pintando-a-palavra-fnl.firebaseapp.com",
      projectId: "pintando-a-palavra-fnl",
      storageBucket: "pintando-a-palavra-fnl.firebasestorage.app",
      messagingSenderId: "394858613454",
      appId: "1:394858613454:web:68ecc607c0414bd7779e9f"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const errorMsg = document.getElementById("errorMsg");
    const loginForm = document.getElementById("loginForm");
    const showLoginBtn = document.getElementById("showLogin");

    // Mostrar o campo Gmail uma vez
    showLoginBtn.addEventListener("click", () => {
      loginForm.classList.remove("hidden");
      showLoginBtn.disabled = true;
      showLoginBtn.style.opacity = "0.7";
      showLoginBtn.style.cursor = "default";
    });

    // Entrar gratuito
    document.getElementById("freeAccess").addEventListener("click", () => {
      localStorage.setItem("isLogged", "true");
      localStorage.setItem("premium", "false");
      errorMsg.textContent = "üé® Entrando no modo gratuito...";
      errorMsg.style.color = "orange";
      setTimeout(() => window.location.href = "index.html", 800);
    });

    // Entrar com Gmail
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim().toLowerCase();
      errorMsg.textContent = "‚è≥ Verificando...";
      errorMsg.style.color = "#333";

      try {
        const ref = doc(db, "usuarios", email);
        const snap = await getDoc(ref);

        if (snap.exists()) {
          fbq('track', 'CompleteRegistration', {
            content_name: 'Login Gmail Premium',
            method: 'EmailForm'
          });

          localStorage.setItem("savedEmail", email);
          localStorage.setItem("isLogged", "true");
          localStorage.setItem("premium", "true");

          errorMsg.textContent = "‚úÖ Acesso Premium confirmado!";
          errorMsg.style.color = "green";
          setTimeout(() => window.location.href = "index.html", 600);
        } else {
          localStorage.setItem("premium", "false");
          errorMsg.innerHTML = `
            <span style="color:red;">
              ‚ùå E-mail n√£o encontrado em nossa base Premium.<br>
              Caso tenha feito a compra, entre em contato com o suporte:<br>
              <a href="https://wa.me/5592999999999?text=Ol√°,%20fiz%20a%20compra%20do%20Pintando%20Premium%20mas%20n√£o%20consigo%20acessar."
              target="_blank" style="color:#007BFF;text-decoration:none;">
              üìû Falar no WhatsApp
              </a>
            </span>
          `;
        }
      } catch (err) {
        console.error(err);
        errorMsg.textContent = "‚ö†Ô∏è Erro ao verificar, tente novamente.";
        errorMsg.style.color = "red";
      }
    });
  </script>

  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      background: #FFF8E7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .login-container {
      text-align: center;
      background: #fff;
      padding: 40px 30px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 380px;
    }
    .logo { width: 90px; margin-bottom: 10px; }
    .subtitle { color: #555; margin-bottom: 25px; }

    .btn-primary {
      background: #FFD54F;
      border: none;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 18px;
      cursor: pointer;
      width: 100%;
      font-weight: 600;
      transition: 0.2s;
    }
    .btn-primary:hover { background: #ffcf33; }

    .btn-secondary {
      background: #fff;
      border: 2px solid #FFD54F;
      color: #444;
      padding: 10px 24px;
      border-radius: 10px;
      font-weight: 500;
      margin-top: 10px;
      cursor: pointer;
      transition: 0.2s;
      width: 100%;
    }
    .btn-secondary:hover { background: #FFF4C1; }

    .btn-login {
      margin-top: 10px;
      background: #FFD54F;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 2px solid #FFD54F;
      border-radius: 8px;
      font-size: 16px;
      text-align: center;
    }

    .hidden { display: none; }

    .error {
      margin-top: 15px;
      font-size: 15px;
      min-height: 30px;
    }

    .checkout {
      margin-top: 25px;
      font-size: 14px;
    }
    .checkout a {
      color: #007BFF;
      text-decoration: none;
      font-weight: 500;
    }
  </style>
</body>
</html>
